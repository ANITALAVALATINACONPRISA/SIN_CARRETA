# JSON File Locations and References

## Canonical File Locations

The following JSON files are the canonical sources of truth for the system:

### Repository Root
```
/home/runner/work/SIN_CARRETA/SIN_CARRETA/
├── decalogo-industrial.latest.clean.json  (210,775 bytes, 300 questions)
└── dnp-standards.latest.clean.json        (79,737 bytes)
```

**These files MUST remain in the repository root** to ensure all modules can reference them correctly.

## Path Resolution Patterns

### 1. Direct Module Loading (`decalogo_loader.py`)

The primary loader module uses `Path(__file__).parent` to resolve paths relative to the module location:

```python
# decalogo_loader.py (line 31)
DEFAULT_TEMPLATE_PATH = Path(__file__).parent / "decalogo-industrial.latest.clean.json"

# decalogo_loader.py (line 224)
standards_path = Path(path) if path else (Path(__file__).parent / "dnp-standards.latest.clean.json")
```

**Resolution:** Both files resolve to repository root since `decalogo_loader.py` is in the root.

### 2. Configuration-Based Loading (`pdm_contra/config/decalogo.yaml`)

The PDM configuration uses relative paths from the config directory:

```yaml
# pdm_contra/config/decalogo.yaml
paths:
  full: "../../decalogo-industrial.latest.clean.json"
  industrial: "../../decalogo-industrial.latest.clean.json"
  dnp: "../../dnp-standards.latest.clean.json"
```

**Resolution:**
- Config directory: `pdm_contra/config/`
- `../../` navigates up two levels to repository root

### 3. Test Files

Test files use two patterns:

#### Pattern A: Repository Root Reference
```python
# test_decalogo_alignment_fix.py (line 46)
cls.repo_root = Path('/home/runner/work/SIN_CARRETA/SIN_CARRETA')
cls.industrial_path = cls.repo_root / 'decalogo-industrial.latest.clean.json'
```

#### Pattern B: Parent Directory Reference
```python
# verify_decalogo_alignment.py (line 202)
decalogo_path = Path(__file__).parent / "decalogo-industrial.latest.clean.json"
```

**Both patterns resolve correctly** when the test files are in the repository root.

### 4. Pipeline and Orchestrator References

```python
# unified_evaluation_pipeline.py (line 351)
decalogo_json = Path("decalogo-industrial.latest.clean.json")
```

This pattern works when the script is run from the repository root directory.

## File Reference Audit

### Files That Load JSON Data (12 files, 33 references)

1. **Core Loaders:**
   - `decalogo_loader.py` - Primary loader with fallback mechanism
   - `pdm_contra/bridges/decatalogo_provider.py` - Provider using config
   - `pdm_contra/bridges/decalogo_loader_adapter.py` - Schema references

2. **Alignment and Processing:**
   - `pdm_contra/decalogo_alignment.py` - Generates versioned outputs
   - `unified_evaluation_pipeline.py` - Main evaluation pipeline

3. **Test Files:**
   - `test_decalogo_loader.py`
   - `test_decalogo_alignment_fix.py`
   - `test_dnp_standards_json.py`
   - `test_miniminimoon_orchestrator_parallel.py`
   - `verify_decalogo_alignment.py`

4. **Test Suites (pdm_contra):**
   - `tests/test_loader_compat.py`
   - `tests/test_crosswalk_isomorphism.py`
   - `tests/test_schema_validation.py`

## Validation

Run the validation script to verify all paths resolve correctly:

```bash
python3 validate_json_file_locations.py
```

This script validates:
- ✓ Files exist in repository root
- ✓ JSON structure is valid
- ✓ Module imports work correctly
- ✓ Config paths resolve correctly
- ✓ Test paths are correct

## Orchestrator Integration

The main orchestrator does not directly reference these JSON files. Instead, it uses the loader modules:

```python
# In any orchestrator or pipeline
from decalogo_loader import get_decalogo_industrial, load_dnp_standards

# Load the canonical data
industrial_data = get_decalogo_industrial()  # Loads from root
dnp_data = load_dnp_standards()              # Loads from root
```

**Benefits:**
1. **Centralized loading** - Single source of truth
2. **Fallback mechanism** - In-memory templates if files unavailable
3. **Thread-safe caching** - Efficient repeated access
4. **Path abstraction** - Modules don't need to know absolute paths

## Version Management

The system maintains two types of files:

### Latest (Working Copies)
- `decalogo-industrial.latest.clean.json`
- `dnp-standards.latest.clean.json`

These are in the **repository root** and are the canonical working versions.

### Versioned (Generated Outputs)
- `pdm_contra/config/out/decalogo-industrial.v1.0.0.clean.json`
- `pdm_contra/config/out/dnp-standards.v1.0.0.clean.json`

These are generated by `pdm_contra/decalogo_alignment.py` and represent frozen versions.

## Migration Notes

If the files need to be moved in the future:

1. **Update `decalogo_loader.py`:**
   - Change `DEFAULT_TEMPLATE_PATH` (line 31)
   - Change `standards_path` calculation (line 224)

2. **Update `pdm_contra/config/decalogo.yaml`:**
   - Adjust relative paths in `paths` section

3. **Update test files** that use absolute paths

4. **Run validation:**
   ```bash
   python3 validate_json_file_locations.py
   ```

## Best Practices

1. **Always use the loader functions:**
   ```python
   from decalogo_loader import get_decalogo_industrial, load_dnp_standards
   ```

2. **Don't hardcode absolute paths** - Use relative paths from `__file__`

3. **Run validation after changes** - Ensure all references still work

4. **Keep files in repository root** - Unless there's a compelling reason to move them

## Troubleshooting

### Issue: "File not found" errors

**Check:**
1. Are you running from the repository root?
2. Is the file name spelled correctly?
3. Does the module use the correct path pattern?

**Solution:**
```python
from pathlib import Path
print(f"Current directory: {Path.cwd()}")
print(f"Script location: {Path(__file__).parent}")
```

### Issue: "Invalid JSON" errors

**Check:**
1. Is the JSON file corrupted?
2. Are there syntax errors?

**Solution:**
```bash
python3 -c "import json; json.load(open('decalogo-industrial.latest.clean.json'))"
```

### Issue: Module can't find files after moving them

**Fix:**
1. Update loader paths
2. Update config file
3. Run validation
4. Update documentation

## Summary

✅ **Current Status:** All files are in the correct location (repository root)

✅ **All References:** Working correctly and validated

✅ **Orchestrator Integration:** Uses loader modules (no direct file references)

✅ **Path Resolution:** All patterns resolve correctly to repository root

The system is correctly configured and all invocations match the available version in the current path.
